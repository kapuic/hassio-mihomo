# Mihomo (Clash.Meta) Configuration Template
# Documentation: https://wiki.metacubex.one/

# Port of HTTP(S) proxy server on the local end
# port: 7890

# Port of SOCKS5 proxy server on the local end
# socks-port: 7891

# HTTP(S) and SOCKS4(A)/SOCKS5 server on the same port
mixed-port: 7893

# Transparent proxy server port for Linux and macOS (Redirect TCP and TProxy UDP)
# redir-port: 7892

# Transparent proxy server port for Linux (TProxy TCP and TProxy UDP)
tproxy-port: 9898

# Allow LAN access
allow-lan: true

# Bind address
# "*": bind all IP addresses
# 192.168.122.11: bind a single IPv4 address
# "[aaaa::a8aa:ff:fe09:57d8]": bind a single IPv6 address
bind-address: "*"

# Router working mode
# rule: rule-based packet routing
# global: all packets will be forwarded to a single endpoint
# direct: directly forward the packets to the Internet
mode: rule

# Log level
# info / warning / error / debug / silent
log-level: info

# IPv6 support (default is true)
ipv6: true

# RESTful API for clash
external-controller: 127.0.0.1:9090

# Static web resource directory
# external-ui: folder

# Secret for RESTful API (required)
# secret: ""

# TCP keep alive interval
# keep-alive-interval: 30

# Interface name
# interface-name: en0

# fwmark on Linux only
# routing-mark: 6666

# Static hosts for DNS server and connection establishment (like /etc/hosts)
hosts:
  # 'mtalk.google.com': 108.177.125.188
  # 'dl.google.com': 180.163.151.161
  # 'dl.l.google.com': 180.163.151.161

# DNS settings
dns:
  enable: true
  listen: 0.0.0.0:53
  # ipv6: true # when set to false, resolver won't translate hostnames to IPv6 addresses

  # DNS over HTTPS
  # use-hosts: true # defaults to true
  # use-system-hosts: true # defaults to true

  # Cache algorithm
  # cache-algorithm: arc # arc/lru/lfu, default arc

  # These nameservers are used to resolve the DNS nameserver hostnames below.
  # Specify IP addresses only
  default-nameserver:
    - 114.114.114.114
    - 8.8.8.8

  enhanced-mode: fake-ip # or redir-host
  fake-ip-range: 198.18.0.1/16

  # Hostnames in this list will not be resolved with fake IPs
  fake-ip-filter:
    - "*.lan"
    - localhost.ptlogin2.qq.com
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.xboxlive.com"
    - "msftconnecttest.com"
    - "xbox.*.microsoft.com"
    - "*.battlenet.com.cn"
    - "*.battlenet.com"
    - "*.blzstatic.cn"
    - "*.battle.net"

  # Nameservers
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - 114.114.114.114
    - 8.8.8.8

  # DNS proxy server policies
  # nameserver-policy:
  #   'www.baidu.com': '114.114.114.114'
  #   '+.internal.crop.com': '10.0.0.1'
  #   'geosite:cn': '114.114.114.114'

# Proxy providers
proxy-providers:
  # provider1:
  #   type: http
  #   url: "url"
  #   interval: 3600
  #   path: ./proxy_providers/provider1.yaml
  #   health-check:
  #     enable: true
  #     interval: 600
  #     url: http://www.gstatic.com/generate_204

# Proxy groups
proxy-groups:
  # - name: Proxy
  #   type: select
  #   proxies:
  #     - auto
  #     - DIRECT

  # - name: auto
  #   type: url-test
  #   proxies:
  #     - ss1
  #     - ss2
  #   url: 'http://www.gstatic.com/generate_204'
  #   interval: 300

# Proxies
proxies:
  # Shadowsocks example
  # - name: "ss1"
  #   type: ss
  #   server: server
  #   port: 443
  #   cipher: chacha20-ietf-poly1305
  #   password: "password"
  #   udp: true

  # VMess example
  # - name: "vmess"
  #   type: vmess
  #   server: server
  #   port: 443
  #   uuid: uuid
  #   alterId: 0
  #   cipher: auto
  #   udp: true
  #   tls: true
  #   servername: example.com

  # Trojan example
  # - name: "trojan"
  #   type: trojan
  #   server: server
  #   port: 443
  #   password: password
  #   udp: true
  #   sni: example.com

# Rules
rules:
  # LAN addresses
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR6,::1/128,DIRECT
  - IP-CIDR6,fc00::/7,DIRECT
  - IP-CIDR6,fe80::/10,DIRECT

  # Final rule
  - MATCH,DIRECT

# Experimental features
# experimental:
#   # Sniff TLS SNI
#   sniff-tls-sni: true
#   # Fingerprint for specific proxy
#   fingerprint: chrome

# Global client fingerprint
# global-client-fingerprint: chrome

# Profile settings
profile:
  # Store the `select` results in $HOME/.config/mihomo/.cache
  store-selected: true
  # Store fake-ip cache
  store-fake-ip: true

# Unified delay (default: false)
# unified-delay: false

# TCP concurrent (default: false)
# tcp-concurrent: false

# Enable process matching (default: false)
# find-process-mode: strict # off/strict/always

# Disable quic to save battery
# global-ua: clash.meta

# GeoIP database URL
# geo-auto-update: true
# geo-update-interval: 24
# geox-url:
#   geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
#   geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"

# TUN configuration
tun:
  enable: false
  stack: system # or gvisor
  # dns-hijack:
  #   - any:53
  #   - tcp://any:53
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

# Sniffer configuration
sniffer:
  enable: false
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
